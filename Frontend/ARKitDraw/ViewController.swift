//
//  ViewController.swift
//  ARKitDraw
//
//  Created by Felix Lapalme on 2017-06-07.
//  Copyright Â© 2017 Felix Lapalme. All rights reserved.
//

import UIKit
import SceneKit
import ARKit
import MapKit
import CoreLocation
import OpenGLES

class ViewController: UIViewController, ARSCNViewDelegate, CLLocationManagerDelegate {

    @IBOutlet var sceneView: ARSCNView!
    var previousPoint: SCNVector3?
    @IBOutlet weak var button: UIButton!
    var lineColor = UIColor.blue
    let locationManager = CLLocationManager()
    var startingPoint = 0
    var long = 0.0
    var lat = 0.0
    var firstlong = 0.0
    var firstlat = 0.0
    var pointArray = [[String : Any]]()
    var buttonHighlighted = false
    var x = 0
    var flag=1
    
    override func viewDidLoad() {
        super.viewDidLoad()
        self.startingPoint = 0;
        // Ask for Authorisation from the User.
        self.locationManager.requestAlwaysAuthorization()
        
        // For use in foreground
        self.locationManager.requestWhenInUseAuthorization()
        
        if CLLocationManager.locationServicesEnabled() {
            locationManager.delegate = self
            locationManager.desiredAccuracy = kCLLocationAccuracyNearestTenMeters
            locationManager.startUpdatingLocation()
        }
        // Set the view's delegate
        sceneView.delegate = self
        
        // Show statistics such as fps and timing information
        sceneView.showsStatistics = true
        
        // Create a new scene
        let scene = SCNScene(named: "art.scnassets/world.scn")!
        
        // Set the scene to the view
        sceneView.scene = scene
    }
    
    override func viewWillAppear(_ animated: Bool) {
        super.viewWillAppear(animated)
        
        // Create a session configuration
        let configuration = ARWorldTrackingConfiguration()
        configuration.worldAlignment = .gravityAndHeading
        // Run the view's session
        sceneView.session.run(configuration)
    }
    
    override func viewWillDisappear(_ animated: Bool) {
        super.viewWillDisappear(animated)
        
        // Pause the view's session
        sceneView.session.pause()
    }
    
    override func didReceiveMemoryWarning() {
        super.didReceiveMemoryWarning()
        // Release any cached data, images, etc that aren't in use.
    }

    // MARK: - ARSCNViewDelegate
    func renderer(_ renderer: SCNSceneRenderer, updateAtTime time: TimeInterval) {
        DispatchQueue.main.async {
            self.buttonHighlighted = self.button.isHighlighted
        }
    }
    func renderer(_ renderer: SCNSceneRenderer, willRenderScene scene: SCNScene, atTime time: TimeInterval) {
        
       // request nearby

//        for item in items
//
        
        
        
//            for point in points
        
        guard let pointOfView = sceneView.pointOfView else { return }
        
        let mat = pointOfView.transform
        let dir = SCNVector3(-1 * mat.m31, -1 * mat.m32, -1 * mat.m33)
        let currentPosition = pointOfView.position + (dir * 0.1)
        print(long)
        print(lat)
        if(flag == 1 && long != 0 && lat != 0 )
            {
        var points = [[String : Any]]()
        points = [["z": -0.67577004, "x": -0.07876582, "y": 0.0138675235], ["z": -0.67522895, "x": -0.07832709, "y": 0.013639968], ["z": -0.67472726, "x": -0.07774256, "y": 0.013661124], ["z": -0.6756299, "x": -0.078649074, "y": 0.013667677], ["z": -0.6753461, "x": -0.0784382, "y": 0.013523787], ["z": -0.67512935, "x": -0.07822237, "y": 0.01302186], ["z": -0.6749282, "x": -0.07804932, "y": 0.012257308], ["z": -0.6746945, "x": -0.077865265, "y": 0.011413984], ["z": -0.6744118, "x": -0.077600904, "y": 0.010704912], ["z": -0.6734252, "x": -0.07552233, "y": 0.012550902], ["z": -0.6730451, "x": -0.07563238, "y": 0.012074944], ["z": -0.6726344, "x": -0.076063246, "y": 0.011359196], ["z": -0.672163, "x": -0.07668312, "y": 0.010306075], ["z": -0.6715361, "x": -0.07723147, "y": 0.009145793], ["z": -0.67071474, "x": -0.07815614, "y": 0.009227894], ["z": -0.6696578, "x": -0.078867644, "y": 0.008739442], ["z": -0.66847277, "x": -0.079859786, "y": 0.008637633], ["z": -0.66715705, "x": -0.08099938, "y": 0.008716829], ["z": -0.66573864, "x": -0.0824099, "y": 0.008662939], ["z": -0.66425437, "x": -0.08412347, "y": 0.008263916], ["z": -0.6628972, "x": -0.08636092, "y": 0.00809535], ["z": -0.66126275, "x": -0.08851536, "y": 0.0070386827], ["z": -0.65943825, "x": -0.09071328, "y": 0.0059850104], ["z": -0.6573717, "x": -0.09295671, "y": 0.0051033497], ["z": -0.6550773, "x": -0.095296524, "y": 0.004347723], ["z": -0.65261865, "x": -0.097924344, "y": 0.003555853], ["z": -0.6513072, "x": -0.10136786, "y": 0.0023699775], ["z": -0.64872634, "x": -0.10446263, "y": 0.0009898953], ["z": -0.64609826, "x": -0.107661925, "y": -0.000790216], ["z": -0.6433705, "x": -0.1108951, "y": -0.00292122], ["z": -0.64048177, "x": -0.11419181, "y": -0.005178135], ["z": -0.63741314, "x": -0.11761873, "y": -0.007421065], ["z": -0.6366892, "x": -0.12412268, "y": -0.008332118], ["z": -0.63333184, "x": -0.12841551, "y": -0.010651551], ["z": -0.62980884, "x": -0.13310924, "y": -0.0130272545], ["z": -0.6260617, "x": -0.13805586, "y": -0.015598584], ["z": -0.62204, "x": -0.14300197, "y": -0.018535893], ["z": -0.6177309, "x": -0.14781937, "y": -0.021877281], ["z": -0.61526155, "x": -0.1548261, "y": -0.024811774], ["z": -0.6105076, "x": -0.1595473, "y": -0.028681517], ["z": -0.6055689, "x": -0.16427901, "y": -0.03268409], ["z": -0.6004454, "x": -0.16921276, "y": -0.036897123], ["z": -0.59509134, "x": -0.17434894, "y": -0.041431446], ["z": -0.5894441, "x": -0.17950585, "y": -0.046135284], ["z": -0.5834359, "x": -0.186232, "y": -0.04809292], ["z": -0.5772433, "x": -0.19102904, "y": -0.052246958], ["z": -0.5708681, "x": -0.19577844, "y": -0.05601166], ["z": -0.5643417, "x": -0.20077427, "y": -0.059449095], ["z": -0.5576794, "x": -0.20619713, "y": -0.062506914], ["z": -0.5509244, "x": -0.21207823, "y": -0.06514415], ["z": -0.54422516, "x": -0.2189588, "y": -0.06559116], ["z": -0.53736484, "x": -0.22545876, "y": -0.06725003], ["z": -0.53044635, "x": -0.23207611, "y": -0.06821125], ["z": -0.52344877, "x": -0.23886888, "y": -0.06838667], ["z": -0.5163541, "x": -0.24582689, "y": -0.067699604], ["z": -0.50917137, "x": -0.25283378, "y": -0.06616654], ["z": -0.5045368, "x": -0.25389528, "y": -0.062379476], ["z": -0.49734527, "x": -0.26087463, "y": -0.059282288], ["z": -0.49012214, "x": -0.26766512, "y": -0.055588946], ["z": -0.4828805, "x": -0.27425486, "y": -0.051370684], ["z": -0.47565085, "x": -0.28062254, "y": -0.046792854], ["z": -0.4684364, "x": -0.28683215, "y": -0.04214898], ["z": -0.46072575, "x": -0.29274395, "y": -0.036793903], ["z": -0.45343813, "x": -0.29880983, "y": -0.03182415], ["z": -0.44612005, "x": -0.30453017, "y": -0.026222572], ["z": -0.43877164, "x": -0.30980372, "y": -0.020163238], ["z": -0.4314903, "x": -0.31448767, "y": -0.014116798], ["z": -0.4242871, "x": -0.31872725, "y": -0.008419994], ["z": -0.41680187, "x": -0.32154188, "y": -0.0013569966], ["z": -0.40965164, "x": -0.3252426, "y": 0.003947649], ["z": -0.40253115, "x": -0.32860023, "y": 0.009417787], ["z": -0.39547187, "x": -0.33147, "y": 0.01511205], ["z": -0.38849998, "x": -0.3337166, "y": 0.020911645], ["z": -0.3816099, "x": -0.3353709, "y": 0.026651006], ["z": -0.37604263, "x": -0.33341497, "y": 0.035896502], ["z": -0.36939934, "x": -0.33403468, "y": 0.041454967], ["z": -0.36281225, "x": -0.3342208, "y": 0.047060683], ["z": -0.35627988, "x": -0.33390665, "y": 0.05280238], ["z": -0.34977075, "x": -0.33311722, "y": 0.05869583], ["z": -0.34329855, "x": -0.33167562, "y": 0.06472607], ["z": -0.33792025, "x": -0.3237055, "y": 0.07338123], ["z": -0.33154088, "x": -0.32063246, "y": 0.07927522], ["z": -0.3251102, "x": -0.3170583, "y": 0.084980994], ["z": -0.31856665, "x": -0.31293362, "y": 0.09068303], ["z": -0.31183624, "x": -0.30816916, "y": 0.09661017], ["z": -0.3049025, "x": -0.3027546, "y": 0.10280371], ["z": -0.3001155, "x": -0.29292998, "y": 0.112157986], ["z": -0.29305542, "x": -0.28662825, "y": 0.1181781], ["z": -0.28600782, "x": -0.28019866, "y": 0.123766355], ["z": -0.27896085, "x": -0.27362975, "y": 0.12883614], ["z": -0.27182692, "x": -0.2666751, "y": 0.13355203], ["z": -0.2644763, "x": -0.25916186, "y": 0.1381763], ["z": -0.2600263, "x": -0.24386132, "y": 0.14530458], ["z": -0.25209817, "x": -0.23512265, "y": 0.15027374], ["z": -0.24388003, "x": -0.22601657, "y": 0.1552552], ["z": -0.23553833, "x": -0.21687679, "y": 0.15982677], ["z": -0.22720209, "x": -0.20786695, "y": 0.16373359], ["z": -0.2188273, "x": -0.19901875, "y": 0.16703694], ["z": -0.2134296, "x": -0.18134406, "y": 0.17114699], ["z": -0.20439687, "x": -0.17183058, "y": 0.1741162], ["z": -0.19491377, "x": -0.1620527, "y": 0.1770149], ["z": -0.18521333, "x": -0.15213875, "y": 0.17960572], ["z": -0.17558166, "x": -0.14236902, "y": 0.18153563], ["z": -0.16614813, "x": -0.13301861, "y": 0.18276523], ["z": -0.16264232, "x": -0.11602299, "y": 0.18326256], ["z": -0.15312868, "x": -0.10724481, "y": 0.18405315], ["z": -0.14319488, "x": -0.09845515, "y": 0.18484455], ["z": -0.13293937, "x": -0.089556575, "y": 0.18542475], ["z": -0.12264523, "x": -0.08065013, "y": 0.18552549], ["z": -0.112590976, "x": -0.07198066, "y": 0.18498018], ["z": -0.10644356, "x": -0.058987804, "y": 0.18426964], ["z": -0.09722678, "x": -0.05087695, "y": 0.1819393], ["z": -0.08808862, "x": -0.042999998, "y": 0.17880096], ["z": -0.07866226, "x": -0.035216443, "y": 0.17520472], ["z": -0.068789266, "x": -0.027547527, "y": 0.17131534], ["z": -0.058613636, "x": -0.0201375, "y": 0.16693947], ["z": -0.04973028, "x": -0.008249672, "y": 0.16196032], ["z": -0.03971215, "x": -0.0017269645, "y": 0.15563272], ["z": -0.029719107, "x": 0.004193792, "y": 0.14838953], ["z": -0.019577578, "x": 0.009416822, "y": 0.14054838], ["z": -0.009161517, "x": 0.01387337, "y": 0.13236578], ["z": 0.0015892461, "x": 0.017496072, "y": 0.124042705], ["z": 0.011431873, "x": 0.022153065, "y": 0.116005085], ["z": 0.022599675, "x": 0.023789667, "y": 0.10750657], ["z": 0.033797115, "x": 0.024301514, "y": 0.09895713], ["z": 0.044956207, "x": 0.02381567, "y": 0.09028874], ["z": 0.056030706, "x": 0.022409126, "y": 0.08118756], ["z": 0.06711772, "x": 0.020106714, "y": 0.071637854], ["z": 0.07803427, "x": 0.01720313, "y": 0.063888684], ["z": 0.08979692, "x": 0.01330667, "y": 0.05468647], ["z": 0.10210372, "x": 0.008797338, "y": 0.04617272], ["z": 0.11490887, "x": 0.002339039, "y": 0.038400874], ["z": 0.12782523, "x": -0.003471205, "y": 0.031044912], ["z": 0.14078553, "x": -0.009983661, "y": 0.023905952], ["z": 0.1573338, "x": -0.013799778, "y": 0.020146307], ["z": 0.17074499, "x": -0.020885784, "y": 0.013915967], ["z": 0.18447718, "x": -0.027836349, "y": 0.008292347], ["z": 0.19841716, "x": -0.034684915, "y": 0.0031685159], ["z": 0.2123453, "x": -0.041544996, "y": -0.0015311465], ["z": 0.2260584, "x": -0.04874458, "y": -0.00597661], ["z": 0.24422598, "x": -0.05412361, "y": -0.007129021], ["z": 0.2577984, "x": -0.062209062, "y": -0.011011332], ["z": 0.2714834, "x": -0.07028772, "y": -0.014244992], ["z": 0.2853102, "x": -0.07818634, "y": -0.01659872], ["z": 0.2991692, "x": -0.085786924, "y": -0.017956037], ["z": 0.3128447, "x": -0.09324252, "y": -0.018817559], ["z": 0.32985222, "x": -0.0995232, "y": -0.017328609], ["z": 0.3430044, "x": -0.10756498, "y": -0.01832408], ["z": 0.35602233, "x": -0.115945525, "y": -0.019142572], ["z": 0.36903283, "x": -0.12428517, "y": -0.019570883], ["z": 0.3820389, "x": -0.13233788, "y": -0.019501459], ["z": 0.39491308, "x": -0.14001913, "y": -0.019016892], ["z": 0.41105032, "x": -0.14603737, "y": -0.01772631], ["z": 0.42355415, "x": -0.15384795, "y": -0.016622778], ["z": 0.43590298, "x": -0.16194713, "y": -0.015008621], ["z": 0.44815287, "x": -0.17022145, "y": -0.013029389], ["z": 0.4603353, "x": -0.17855844, "y": -0.010752879], ["z": 0.47249243, "x": -0.1870101, "y": -0.008105293], ["z": 0.4859689, "x": -0.19612467, "y": -0.005031217], ["z": 0.49814248, "x": -0.20518339, "y": -0.0015100949], ["z": 0.51033086, "x": -0.2145001, "y": 0.0023809224], ["z": 0.52251613, "x": -0.22400996, "y": 0.006506365], ["z": 0.534676, "x": -0.23353381, "y": 0.010837443], ["z": 0.5468336, "x": -0.24297006, "y": 0.015451398], ["z": 0.5628106, "x": -0.25240228, "y": 0.020571291], ["z": 0.5750922, "x": -0.26093733, "y": 0.02599084], ["z": 0.58743453, "x": -0.26886854, "y": 0.03174628], ["z": 0.5998179, "x": -0.27613318, "y": 0.037609648], ["z": 0.61227655, "x": -0.2828321, "y": 0.04357658], ["z": 0.62487215, "x": -0.2889096, "y": 0.04991302], ["z": 0.6417618, "x": -0.29608622, "y": 0.054838605], ["z": 0.6544834, "x": -0.30071795, "y": 0.062251218], ["z": 0.66698056, "x": -0.30472073, "y": 0.06988794], ["z": 0.67913735, "x": -0.30826357, "y": 0.07752415], ["z": 0.69092894, "x": -0.31149036, "y": 0.084867574], ["z": 0.7024149, "x": -0.31434926, "y": 0.091860294], ["z": 0.71365243, "x": -0.31633073, "y": 0.098725155], ["z": 0.7291023, "x": -0.3197832, "y": 0.10446903], ["z": 0.7401417, "x": -0.31942225, "y": 0.11200754], ["z": 0.751006, "x": -0.31804892, "y": 0.11992036], ["z": 0.76158327, "x": -0.3159565, "y": 0.12788412], ["z": 0.7717892, "x": -0.31327984, "y": 0.1355159], ["z": 0.7815846, "x": -0.3097751, "y": 0.14273156], ["z": 0.79638416, "x": -0.30691996, "y": 0.14655647], ["z": 0.8057096, "x": -0.30122223, "y": 0.15330614], ["z": 0.81496775, "x": -0.29474363, "y": 0.16028418], ["z": 0.8243171, "x": -0.2879295, "y": 0.16778627], ["z": 0.8337351, "x": -0.2809174, "y": 0.17568305], ["z": 0.84971803, "x": -0.27749795, "y": 0.18142514], ["z": 0.8590298, "x": -0.27045664, "y": 0.18846062], ["z": 0.8682046, "x": -0.26290956, "y": 0.19463098], ["z": 0.8774522, "x": -0.25452232, "y": 0.20010324], ["z": 0.88696015, "x": -0.24527222, "y": 0.20514098], ["z": 0.896821, "x": -0.23545751, "y": 0.20996338], ["z": 0.9075392, "x": -0.22663467, "y": 0.21302645], ["z": 0.9177787, "x": -0.21680295, "y": 0.21734616], ["z": 0.9279843, "x": -0.20717445, "y": 0.22120354], ["z": 0.93809855, "x": -0.19771859, "y": 0.22444922], ["z": 0.94563437, "x": -0.20025468, "y": 0.22689459], ["z": 0.9558115, "x": -0.1905883, "y": 0.22856873], ["z": 0.96212685, "x": -0.18072718, "y": 0.22716339], ["z": 0.97303575, "x": -0.1710211, "y": 0.22843282], ["z": 0.9844769, "x": -0.16151361, "y": 0.22979823], ["z": 0.99630344, "x": -0.15225582, "y": 0.2310544], ["z": 1.0082893, "x": -0.14326815, "y": 0.23178184], ["z": 1.0202502, "x": -0.13451737, "y": 0.23158024], ["z": 1.0265322, "x": -0.123850174, "y": 0.22822677], ["z": 1.0381122, "x": -0.11614668, "y": 0.2258984], ["z": 1.0499336, "x": -0.10907489, "y": 0.22307825], ["z": 1.0622604, "x": -0.102547884, "y": 0.22004612], ["z": 1.0750988, "x": -0.096526526, "y": 0.21688774], ["z": 1.0881581, "x": -0.09108378, "y": 0.21336396], ["z": 1.0944382, "x": -0.0842532, "y": 0.20665537], ["z": 1.1071596, "x": -0.080028914, "y": 0.201837], ["z": 1.1196506, "x": -0.07643487, "y": 0.19635668], ["z": 1.1320026, "x": -0.07335432, "y": 0.19034824], ["z": 1.1442816, "x": -0.07082349, "y": 0.1839729], ["z": 1.156553, "x": -0.06885108, "y": 0.17733163], ["z": 1.1644909, "x": -0.06521174, "y": 0.169462], ["z": 1.1771626, "x": -0.063966684, "y": 0.16222513], ["z": 1.1901572, "x": -0.062904894, "y": 0.15472792], ["z": 1.2032295, "x": -0.062103055, "y": 0.14692754], ["z": 1.2160484, "x": -0.06179139, "y": 0.13854364], ["z": 1.228537, "x": -0.0620492, "y": 0.12955932], ["z": 1.2394646, "x": -0.060257792, "y": 0.11993274], ["z": 1.2519687, "x": -0.061362743, "y": 0.110552564], ["z": 1.2648141, "x": -0.06283967, "y": 0.10152448], ["z": 1.2780052, "x": -0.06472829, "y": 0.093121484], ["z": 1.2914335, "x": -0.06689659, "y": 0.08526769], ["z": 1.3046962, "x": -0.06952702, "y": 0.0774467], ["z": 1.3147321, "x": -0.070887685, "y": 0.06934393], ["z": 1.3270526, "x": -0.07498018, "y": 0.060926344], ["z": 1.3392813, "x": -0.07968313, "y": 0.052610006], ["z": 1.3515953, "x": -0.08482927, "y": 0.044597622], ["z": 1.3638823, "x": -0.090464704, "y": 0.036890186], ["z": 1.3758445, "x": -0.09686138, "y": 0.029479753], ["z": 1.384858, "x": -0.10249823, "y": 0.022137627], ["z": 1.3958578, "x": -0.11095776, "y": 0.015337173], ["z": 1.4067502, "x": -0.120265156, "y": 0.0088924505], ["z": 1.4177742, "x": -0.13019612, "y": 0.0028412081], ["z": 1.4290639, "x": -0.14053589, "y": -0.0028116852], ["z": 1.4405876, "x": -0.15117294, "y": -0.007983904], ["z": 1.4503659, "x": -0.16260158, "y": -0.01137206], ["z": 1.4618573, "x": -0.17406414, "y": -0.015637875], ["z": 1.4732863, "x": -0.1859399, "y": -0.01962168], ["z": 1.4847186, "x": -0.19807465, "y": -0.02341547], ["z": 1.4961962, "x": -0.21036807, "y": -0.027114224], ["z": 1.5077381, "x": -0.22273663, "y": -0.030824147], ["z": 1.5191576, "x": -0.2348446, "y": -0.032950267], ["z": 1.53079, "x": -0.24707651, "y": -0.036538858], ["z": 1.5425551, "x": -0.25936204, "y": -0.039921775], ["z": 1.5545069, "x": -0.27176383, "y": -0.042842627], ["z": 1.5666652, "x": -0.2843173, "y": -0.045393135], ["z": 1.5790172, "x": -0.29706332, "y": -0.04772797], ["z": 1.5926299, "x": -0.30991405, "y": -0.0485931], ["z": 1.6053612, "x": -0.32300058, "y": -0.050365757], ["z": 1.6182069, "x": -0.3360674, "y": -0.051829834], ["z": 1.6310296, "x": -0.34912413, "y": -0.053160504], ["z": 1.6437593, "x": -0.36240202, "y": -0.054517087], ["z": 1.6564677, "x": -0.37605193, "y": -0.05562838], ["z": 1.6703588, "x": -0.3902951, "y": -0.055171642], ["z": 1.6833185, "x": -0.40384552, "y": -0.054654546], ["z": 1.6964236, "x": -0.41700566, "y": -0.053433023], ["z": 1.7096233, "x": -0.42983636, "y": -0.051613197], ["z": 1.7228571, "x": -0.44262016, "y": -0.0492301], ["z": 1.7360967, "x": -0.45555353, "y": -0.04646455], ["z": 1.7509253, "x": -0.4696478, "y": -0.043359548], ["z": 1.7641239, "x": -0.48247257, "y": -0.039994966], ["z": 1.777362, "x": -0.4948194, "y": -0.03605799], ["z": 1.7906293, "x": -0.5064894, "y": -0.031461395], ["z": 1.8038591, "x": -0.5176532, "y": -0.026434522], ["z": 1.8169584, "x": -0.5286162, "y": -0.021215763], ["z": 1.8304211, "x": -0.5404922, "y": -0.017885048], ["z": 1.8431108, "x": -0.5513478, "y": -0.012272671], ["z": 1.8555548, "x": -0.56182843, "y": -0.0061303712], ["z": 1.8677298, "x": -0.57171625, "y": 0.00037897378], ["z": 1.8795971, "x": -0.58096385, "y": 0.007092867], ["z": 1.891155, "x": -0.5895844, "y": 0.01409981], ["z": 1.9016279, "x": -0.59938085, "y": 0.020826675], ["z": 1.9126183, "x": -0.60656893, "y": 0.029342901], ["z": 1.9233173, "x": -0.6128066, "y": 0.03855215], ["z": 1.9336207, "x": -0.61801296, "y": 0.048018724], ["z": 1.9434662, "x": -0.6222858, "y": 0.057526667], ["z": 1.9528593, "x": -0.6256806, "y": 0.06711109], ["z": 1.9618247, "x": -0.6282512, "y": 0.07689412], ["z": 1.9726577, "x": -0.6324441, "y": 0.08372383], ["z": 1.9809399, "x": -0.6336887, "y": 0.09421034], ["z": 1.9888923, "x": -0.6341655, "y": 0.10484525], ["z": 1.9965166, "x": -0.6338191, "y": 0.1152962], ["z": 2.0038707, "x": -0.632579, "y": 0.1253502], ["z": 2.0110548, "x": -0.6302439, "y": 0.1349839], ["z": 2.0098066, "x": -0.6528684, "y": 0.14144577], ["z": 2.016846, "x": -0.64800656, "y": 0.14992891], ["z": 2.0239937, "x": -0.6420211, "y": 0.15795016], ["z": 2.0312688, "x": -0.6353584, "y": 0.16545394], ["z": 2.038643, "x": -0.6282987, "y": 0.1723796], ["z": 2.0461354, "x": -0.6209131, "y": 0.17869154], ["z": 2.0502477, "x": -0.61211777, "y": 0.18145621], ["z": 2.0580413, "x": -0.60366327, "y": 0.18665831], ["z": 2.0660336, "x": -0.594767, "y": 0.19128454], ["z": 2.0742574, "x": -0.58554214, "y": 0.19539317], ["z": 2.0828063, "x": -0.575949, "y": 0.19908576], ["z": 2.0916593, "x": -0.56608486, "y": 0.20220153], ["z": 2.0911293, "x": -0.5520201, "y": 0.200774], ["z": 2.1002657, "x": -0.5419573, "y": 0.2022726], ["z": 2.1098018, "x": -0.5318266, "y": 0.20322731], ["z": 2.1199389, "x": -0.5215603, "y": 0.20396602], ["z": 2.1307106, "x": -0.5112888, "y": 0.20464085], ["z": 2.131998, "x": -0.49660522, "y": 0.20265333], ["z": 2.1433816, "x": -0.4866274, "y": 0.2027951], ["z": 2.154857, "x": -0.47699434, "y": 0.20232187], ["z": 2.1663623, "x": -0.46770972, "y": 0.2011376], ["z": 2.1779037, "x": -0.45888442, "y": 0.19936502], ["z": 2.189619, "x": -0.45054385, "y": 0.19724818], ["z": 2.192419, "x": -0.4386111, "y": 0.1929356], ["z": 2.2047985, "x": -0.43074098, "y": 0.19044825], ["z": 2.2174137, "x": -0.42313096, "y": 0.18748558], ["z": 2.2301054, "x": -0.41582444, "y": 0.1838665], ["z": 2.242832, "x": -0.40891188, "y": 0.17955887], ["z": 2.2556455, "x": -0.4024409, "y": 0.17471172], ["z": 2.2609642, "x": -0.39518705, "y": 0.16710916], ["z": 2.2738311, "x": -0.3896623, "y": 0.1617141], ["z": 2.2867959, "x": -0.38461873, "y": 0.15609427], ["z": 2.2999353, "x": -0.3799409, "y": 0.15016943], ["z": 2.3132396, "x": -0.37559935, "y": 0.14386445], ["z": 2.3266609, "x": -0.37160558, "y": 0.1371416], ["z": 2.3358173, "x": -0.368308, "y": 0.12859246], ["z": 2.3492498, "x": -0.36509863, "y": 0.12136461], ["z": 2.362459, "x": -0.36239144, "y": 0.11385532], ["z": 2.375332, "x": -0.3602979, "y": 0.106072426], ["z": 2.3879457, "x": -0.35886484, "y": 0.09811263], ["z": 2.4006011, "x": -0.35796112, "y": 0.09013567], ["z": 2.4080334, "x": -0.35793746, "y": 0.080096215], ["z": 2.4211717, "x": -0.3575865, "y": 0.07256234], ["z": 2.4341633, "x": -0.35767835, "y": 0.06528444], ["z": 2.4466562, "x": -0.3583964, "y": 0.058103226], ["z": 2.458611, "x": -0.3597529, "y": 0.051003844], ["z": 2.4702282, "x": -0.36167198, "y": 0.04416624], ["z": 2.478299, "x": -0.3620146, "y": 0.037000522], ["z": 2.4894688, "x": -0.36477995, "y": 0.030752301], ["z": 2.500241, "x": -0.36811298, "y": 0.024882574], ["z": 2.510523, "x": -0.37213153, "y": 0.019565832], ["z": 2.5203736, "x": -0.37676692, "y": 0.0147989355], ["z": 2.529909, "x": -0.38191947, "y": 0.010384917], ["z": 2.5379488, "x": -0.386443, "y": 0.006652847], ["z": 2.5473857, "x": -0.3920316, "y": 0.0024437942], ["z": 2.5567837, "x": -0.3977503, "y": -0.001818493], ["z": 2.565908, "x": -0.4038603, "y": -0.005970601], ["z": 2.574638, "x": -0.41052487, "y": -0.009727199], ["z": 2.583012, "x": -0.41772726, "y": -0.01296711], ["z": 2.5918214, "x": -0.42401192, "y": -0.015686568], ["z": 2.5998106, "x": -0.43202487, "y": -0.018254634], ["z": 2.607849, "x": -0.43997613, "y": -0.020777]]
        let longFetched = -123.25571851318668
        let latFetched = 49.263688748390635
        let deltaLong =  longFetched - long
        let deltaLat =  latFetched - lat
        print("deltaLong")
        print(deltaLong)
        print("deltaLat")
        print(deltaLat)
        let xdiff = deltaLong*(111111.0 * cos(deltaLat * Double.pi / 180))
        let zdiff = deltaLat*(111111.0)
        var index = 0
                print(points[index]["x"])
        while index < points.count-1 {
            let first = SCNVector3.init(points[index]["x"] as! Double + xdiff, points[index]["y"] as! Double, points[index]["z"] as! Double + zdiff)
            let second = SCNVector3.init(points[index+1]["x"] as! Double + xdiff , points[index+1]["y"] as! Double, points[index+1]["z"] as! Double + zdiff  )
            let line = lineFrom(vector: first, toVector: second)
            let lineNode = SCNNode(geometry: line)
            lineNode.geometry?.firstMaterial?.diffuse.contents = lineColor
            sceneView.scene.rootNode.addChildNode(lineNode)
            index = index + 1
        }
        flag = 0
    }
        
       
        
        if buttonHighlighted {
            if startingPoint == 0 {
                firstlong = long
                firstlat = lat
                print(firstlong)
                print(firstlat)
                startingPoint = 1
            }
          
            if let previousPoint = previousPoint {
//                let line = lineFrom(vector: previousPoint, toVector: currentPosition)
//                let lineNode = SCNNode(geometry: line)
//                lineNode.geometry?.firstMaterial?.diffuse.contents = lineColor
//                sceneView.scene.rootNode.addChildNode(lineNode)
                
                let twoPointsNode1 = SCNNode();
                scene.rootNode.addChildNode(twoPointsNode1.buildLine(
                    from: previousPoint, to: currentPosition, radius: 0.005, color: .cyan))
            }
            let point: [String: Any] =
                [
                    "x": currentPosition.x as! Float,
                    "y": currentPosition.y as! Float,
                    "z": currentPosition.z as! Float,
                    ]
            pointArray.append(point)
            
            x = 1
        }
        else {
            if (x == 1){
                print("BUTTON LEFT")
                x = 0
                startingPoint = 0
                /// send request
                print(pointArray)
            }
        }
        previousPoint = currentPosition
        //let prev = previousPoint.worldPosition
       
        
        glLineWidth(200)
    }
    
    func session(_ session: ARSession, didFailWithError error: Error) {
        // Present an error message to the user
    }
    
    func sessionWasInterrupted(_ session: ARSession) {
        // Inform the user that the session has been interrupted, for example, by presenting an overlay
    }
    
    func sessionInterruptionEnded(_ session: ARSession) {
        // Reset tracking and/or remove existing anchors if consistent tracking is required
        
    }
    func locationManager(_ manager: CLLocationManager, didUpdateLocations locations: [CLLocation]) {
        guard let locValue: CLLocationCoordinate2D = manager.location?.coordinate else { return }
            long = locValue.longitude
            lat = locValue.latitude
        //print("locations = \(locValue.latitude) \(locValue.longitude)")
    }
    
    func lineFrom(vector vector1: SCNVector3, toVector vector2: SCNVector3) -> SCNGeometry {
        
        let indices: [Int32] = [0, 1]
        
        let source = SCNGeometrySource(vertices: [vector1, vector2])
        let element = SCNGeometryElement(indices: indices, primitiveType: .line)
        
        return SCNGeometry(sources: [source], elements: [element])
        
    }
    
    
}
